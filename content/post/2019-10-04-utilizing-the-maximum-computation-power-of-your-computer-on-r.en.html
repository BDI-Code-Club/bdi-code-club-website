---
title: Utilizing the maximum computation power of your computer on R
author: Sanjay Rathee
date: '2019-10-01'
slug: utilizing-the-maximum-computation-power-of-your-computer-on-r
categories: []
tags:
  - caret
  - parallel
type: ''
subtitle: ''
image: ''
---



<div id="note" class="section level1">
<h1>Note</h1>
<p>Please open your R-Studio as an administrator.</p>
</div>
<div id="overview" class="section level1">
<h1>Overview</h1>
<p>In this tutorial, we introduce a package to use multiple cores of your system.</p>
<p>After this tutorial you will be able to:</p>
<ul>
<li>Train a neural network model without using multicores</li>
<li>Train a neural network model without using multicores</li>
<li>Compare results</li>
</ul>
</div>
<div id="using-r-markdown" class="section level1">
<h1>Using R Markdown</h1>
<p>The tutorial that follows was created using R Markdown. As an exercise in using R Markdown, here, we ask you to save your work in an R Markdown file. By the end of this session, you will have recreated the .Rmd file of this tutorial. You don’t have to retype the instruction and comments. Focus only on the R code and add notes that are useful for your own understanding.</p>
<p>To create an R Markdown file:</p>
<ul>
<li>Choose <strong>File</strong> -&gt; <strong>New File</strong> -&gt; <strong>R Markdown…</strong> from RStudio menu.</li>
<li>Save this file with the name <strong>Rcode.Rmd</strong> in your working directory. Don’t change the other R Markdown options.</li>
<li>From R studio menu use <strong>Code</strong> -&gt; <strong>Insert Chunk</strong> to add boxes to save R code.</li>
</ul>
<p>You may use the R Markdown cheat sheet <a href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf</a> to further format the output of the R Markdown file.</p>
</div>
<div id="r-markdown-setup" class="section level1">
<h1>R Markdown setup</h1>
<p>This is generated by default when we create an R Markdown file.</p>
<pre class="r"><code># Change this to match the directory you have stored your scripts and data
root_directory &lt;- &quot;/media/sanju/B47A9D517A9D10EA/sanju-personal/rcode-clinic/rcode&quot;

knitr::opts_chunk$set(echo = TRUE)
# knitr::opts_knit$set(root.dir = root_directory)</code></pre>
</div>
<div id="required-packages" class="section level1">
<h1>Required packages</h1>
<p>Uncomment and install a package if you didn’t already.</p>
<pre class="r"><code>#install.packages(&quot;caret&quot;)
library(caret)</code></pre>
<pre><code>## Loading required package: lattice</code></pre>
<pre><code>## Loading required package: ggplot2</code></pre>
<pre class="r"><code># install.packages(&quot;doMC&quot;, repos=&quot;http://R-Forge.R-project.org&quot;)
require(doMC)</code></pre>
<pre><code>## Loading required package: doMC</code></pre>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## Loading required package: iterators</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre class="r"><code>## For Windows
#install.packages(&quot;doParallel&quot;)
#require(doParallel)
#install.packages(&quot;e1071&quot;)
#library(e1097)</code></pre>
</div>
<div id="downloading-data" class="section level1">
<h1>Downloading Data</h1>
<p>The data we are going to use a csv file (having gene expressions for patients) and clinical data (having response) from a breast cancer study. The data are available in folder “session-1” of this link (<a href="https://github.com/sanjaysinghrathi/Rcode-clinic/blob/master/Data.csv" class="uri">https://github.com/sanjaysinghrathi/Rcode-clinic/blob/master/Data.csv</a>).</p>
<p>The data file having <em>.csv</em> extension includes the gene expression data for 19 samples (patients) as well as includes clinical parameters like response referring to the samples.</p>
<pre class="r"><code>print(&quot;Welcome to Session 1&quot;)</code></pre>
<pre><code>## [1] &quot;Welcome to Session 1&quot;</code></pre>
</div>
<div id="load-data" class="section level1">
<h1>Load data</h1>
<p>Use this code to read the <code>data.csv</code> file into R directly from Github. Note that will <strong>not</strong> save the data to your computer. Alternatively, you can download the file using the link above and read it from your local directory.</p>
<pre class="r"><code>## Load data file
data &lt;- read.csv(&quot;https://raw.githubusercontent.com/sanjaysinghrathi/Rcode-clinic/master/Data.csv&quot;, header = TRUE, row.names = 1)</code></pre>
</div>
<div id="train-the-neural-network-model" class="section level1">
<h1>Train the neural network model</h1>
<p>Put the timer on to check the time used by model for training.</p>
<pre class="r"><code>start_time &lt;- Sys.time()
numFolds &lt;- trainControl(method = &#39;LOOCV&#39;, allowParallel = TRUE, verbose=TRUE , search = &quot;grid&quot;)
grid &lt;- expand.grid(size=c(seq(from = 1, to = 10, by = 1)),
                    decay=c(seq(from = 0.0, to = 0.9, by = 0.1)))
set.seed(567)
garbage &lt;- capture.output(suppressWarnings(model &lt;- train(response ~ ., data, method=&#39;nnet&#39;, trace = FALSE, preProcess = c(&#39;center&#39;, &#39;scale&#39;), metric=&quot;Accuracy&quot;, trControl = numFolds, linout=FALSE, tuneGrid=grid)))
max(model$results$Accuracy, na.rm = TRUE)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>training_time &lt;- Sys.time()
print(&quot;Training time...&quot;)</code></pre>
<pre><code>## [1] &quot;Training time...&quot;</code></pre>
<pre class="r"><code>training_time-start_time</code></pre>
<pre><code>## Time difference of 1.420509 mins</code></pre>
<p><strong>Question</strong>: How much time is used by the model to train?</p>
</div>
<div id="set-the-number-of-cores-for-domc" class="section level1">
<h1>Set the number of cores for DoMC</h1>
<p>Find the number of cores available on your computer.</p>
<pre class="r"><code>registerDoMC(cores=6)

## For Window users
#registerdoParallel(cores=6)</code></pre>
</div>
<div id="train-the-neural-network-model-with-maximum-possible-cores-on-computer" class="section level1">
<h1>Train the neural network model with maximum possible cores on computer</h1>
<p>Put the timer on to check the time used by model for training.</p>
<pre class="r"><code>start_time &lt;- Sys.time()
numFolds &lt;- trainControl(method = &#39;LOOCV&#39;, allowParallel = TRUE, verbose=TRUE , search = &quot;grid&quot;)
grid &lt;- expand.grid(size=c(seq(from = 1, to = 10, by = 1)),
                    decay=c(seq(from = 0.0, to = 0.9, by = 0.1)))
set.seed(567)
garbage &lt;- capture.output(suppressWarnings(model &lt;- train(response ~ ., data, method=&#39;nnet&#39;, trace = FALSE, preProcess = c(&#39;center&#39;, &#39;scale&#39;), metric=&quot;Accuracy&quot;, trControl = numFolds, linout=FALSE, tuneGrid=grid)))
max(model$results$Accuracy, na.rm = TRUE)</code></pre>
<pre><code>## [1] 1</code></pre>
<pre class="r"><code>training_time &lt;- Sys.time()
print(&quot;Training time...&quot;)</code></pre>
<pre><code>## [1] &quot;Training time...&quot;</code></pre>
<pre class="r"><code>training_time-start_time</code></pre>
<pre><code>## Time difference of 1.37038 mins</code></pre>
<p><strong>Question:</strong> How much time is taken by the model to train with 6 cores?</p>
</div>
<div id="cleaning" class="section level1">
<h1>Cleaning</h1>
<p>Remove unwanted data.</p>
<pre class="r"><code>rm(numFolds)
rm(grid)
rm(model)</code></pre>
<p><strong>Question:</strong> Repeat the same to find out time required to train model with different number of cores.</p>
</div>
